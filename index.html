import React, { useState, useEffect } from 'react';
import { Volume2, Square, Play, BookOpen, Calculator } from 'lucide-react';

export default function StatsAudioExplainer() {
  const [speaking, setSpeaking] = useState(false);
  const [selectedTopic, setSelectedTopic] = useState('variance');
  const [voices, setVoices] = useState([]);
  const [selectedVoice, setSelectedVoice] = useState(null);
  const [showExample, setShowExample] = useState(false);

  useEffect(() => {
    const loadVoices = () => {
      const availableVoices = window.speechSynthesis.getVoices();
      
      const qualityVoices = availableVoices.filter(v => {
        const name = v.name.toLowerCase();
        const lang = v.lang.toLowerCase();
        
        return (lang.startsWith('pt') || lang.includes('br')) &&
               (name.includes('google') || 
                name.includes('microsoft') || 
                name.includes('luciana') ||
                name.includes('premium') ||
                name.includes('natural') ||
                v.localService === false);
      });
      
      const voicesToUse = qualityVoices.length > 0 ? qualityVoices : 
                          availableVoices.filter(v => v.lang.startsWith('pt'));
      
      setVoices(voicesToUse.length > 0 ? voicesToUse : availableVoices);
      
      if (voicesToUse.length > 0) {
        const preferredVoice = voicesToUse.find(v => 
          v.name.toLowerCase().includes('google') || 
          v.name.toLowerCase().includes('microsoft')
        ) || voicesToUse[0];
        setSelectedVoice(preferredVoice);
      } else if (availableVoices.length > 0) {
        setSelectedVoice(availableVoices[0]);
      }
    };

    loadVoices();
    window.speechSynthesis.onvoiceschanged = loadVoices;
  }, []);

  const topics = {
    variance: {
      title: 'Vari√¢ncia',
      formula: 'œÉ¬≤ = Œ£(x·µ¢-Œº)¬≤/N  |  s¬≤ = Œ£(x·µ¢-xÃÑ)¬≤/(n-1)',
      explanation: 'A vari√¢ncia mede a dispers√£o dos dados. Existem DUAS f√≥rmulas: Vari√¢ncia POPULACIONAL (œÉ¬≤) divide por N quando temos TODA a popula√ß√£o. Vari√¢ncia AMOSTRAL (s¬≤) divide por n-1 quando temos apenas uma AMOSTRA, para corrigir o vi√©s. O n-1 s√£o os graus de liberdade.',
      exampleTitle: 'Exemplo: Notas - Populacional vs Amostral',
      exampleData: 'Notas: 7, 8, 6, 9, 7, 8, 7',
      tableData: [
        ['i', 'xi', 'xi - Œº', '(xi - Œº)¬≤'],
        ['1', '7', '-0,43', '0,18'],
        ['2', '8', '0,57', '0,32'],
        ['3', '6', '-1,43', '2,04'],
        ['4', '9', '1,57', '2,46'],
        ['5', '7', '-0,43', '0,18'],
        ['6', '8', '0,57', '0,32'],
        ['7', '7', '-0,43', '0,18'],
        ['Œ£', '52', '0', '5,68']
      ],
      steps: 'PASSO 1: M√©dia: (7+8+6+9+7+8+7)/7 = 52/7 = 7,43. PASSO 2: Desvios: 7-7,43=-0,43; 8-7,43=0,57; 6-7,43=-1,43; 9-7,43=1,57; etc. PASSO 3: Quadrados: 0,18; 0,32; 2,04; 2,46; 0,18; 0,32; 0,18. PASSO 4: Soma: 5,68. PASSO 5A: Vari√¢ncia POPULACIONAL: œÉ¬≤=5,68/7=0,81. PASSO 5B: Vari√¢ncia AMOSTRAL: s¬≤=5,68/(7-1)=5,68/6=0,95. DIFEREN√áA: A amostral √© maior! Use populacional se estes s√£o TODOS os alunos. Use amostral se √© uma AMOSTRA de uma turma maior.',
      audio: 'Vamos calcular AMBAS as vari√¢ncias de 7 notas. Primeiro, a m√©dia: somamos 7, 8, 6, 9, 7, 8 e 7, dando 52. Dividimos por 7: m√©dia 7,43. Segundo, calculamos os desvios: 7 menos 7,43 igual a menos 0,43. 8 menos 7,43 igual a 0,57. 6 menos 7,43 igual a menos 1,43. 9 menos 7,43 igual a 1,57. E assim por diante. Terceiro, elevamos cada desvio ao quadrado: 0,18; 0,32; 2,04; 2,46; 0,18; 0,32; 0,18. Quarto, somamos todos: 5,68. AGORA ATEN√á√ÉO! Temos DUAS op√ß√µes: VARI√ÇNCIA POPULACIONAL: dividimos por N igual a 7. Resultado: 0,81. Use quando temos TODA a popula√ß√£o. VARI√ÇNCIA AMOSTRAL: dividimos por n menos 1 igual a 6. Resultado: 0,95. Use quando temos uma AMOSTRA. A amostral √© sempre maior porque corrige o vi√©s da amostra usando n menos 1, os graus de liberdade.',
      color: 'from-blue-500 to-purple-600'
    },
    standardDev: {
      title: 'Desvio Padr√£o',
      formula: 'œÉ = ‚àö(Œ£(x·µ¢-Œº)¬≤/N)  |  s = ‚àö(Œ£(x·µ¢-xÃÑ)¬≤/(n-1))',
      explanation: 'O desvio padr√£o √© a raiz quadrada da vari√¢ncia. Tem a mesma unidade dos dados originais. DESVIO POPULACIONAL (œÉ) usa N no denominador. DESVIO AMOSTRAL (s) usa n-1. A escolha depende se voc√™ tem toda a popula√ß√£o ou apenas uma amostra.',
      exampleTitle: 'Exemplo: Temperaturas em 7 Dias',
      exampleData: 'Temperaturas: 22, 24, 21, 25, 23, 22, 24¬∞C',
      tableData: [
        ['Dia', 'Temp', 'Desvio', 'Desvio¬≤'],
        ['1', '22', '-1', '1'],
        ['2', '24', '1', '1'],
        ['3', '21', '-2', '4'],
        ['4', '25', '2', '4'],
        ['5', '23', '0', '0'],
        ['6', '22', '-1', '1'],
        ['7', '24', '1', '1'],
        ['Œ£', '161', '0', '12']
      ],
      steps: 'PASSO 1: M√©dia = 161/7 = 23¬∞C. PASSO 2: Desvios: -1, 1, -2, 2, 0, -1, 1. PASSO 3: Quadrados: 1, 1, 4, 4, 0, 1, 1. PASSO 4: Soma = 12. PASSO 5A: Vari√¢ncia POPULACIONAL = 12/7 = 1,714. PASSO 5B: Vari√¢ncia AMOSTRAL = 12/6 = 2,00. PASSO 6A: Desvio Padr√£o POPULACIONAL = ‚àö1,714 = 1,31¬∞C. PASSO 6B: Desvio Padr√£o AMOSTRAL = ‚àö2,00 = 1,41¬∞C. QUANDO USAR: Populacional se s√£o TODAS as temperaturas do per√≠odo. Amostral se √© uma AMOSTRA de dias.',
      audio: 'Calculando AMBOS os desvios padr√£o de temperaturas. M√©dia: 161 dividido por 7 igual a 23 graus. Desvios: menos 1, mais 1, menos 2, mais 2, zero, menos 1, mais 1. Quadrados: 1, 1, 4, 4, 0, 1, 1. Soma: 12. AGORA CALCULAMOS AS DUAS VARI√ÇNCIAS: POPULACIONAL: 12 dividido por 7 igual a 1,714. AMOSTRAL: 12 dividido por 6 igual a 2,00. AGORA OS DESVIOS PADR√ÉO: POPULACIONAL: raiz de 1,714 igual a 1,31 graus. AMOSTRAL: raiz de 2,00 igual a 1,41 graus. A diferen√ßa √© de 0,1 grau. Use o populacional se estes 7 dias s√£o TODOS os dias que voc√™ quer analisar. Use o amostral se estes 7 dias s√£o uma AMOSTRA de um per√≠odo maior, como representantes de um m√™s inteiro.',
      color: 'from-green-500 to-teal-600'
    },
    freqSimple: {
      title: 'Frequ√™ncia Simples',
      formula: 'fi = freq. absoluta | fr = fi/n',
      explanation: 'Organiza dados contando quantas vezes cada valor aparece. Frequ√™ncia absoluta √© a contagem. Frequ√™ncia relativa √© a propor√ß√£o do total.',
      exampleTitle: 'Exemplo: Notas de 20 Alunos',
      exampleData: 'Notas: 5,6,7,7,6,8,7,9,6,7,8,7,6,7,8,9,7,8,7,6',
      tableData: [
        ['Nota', 'fi', 'fr', 'fr%', 'Fi', 'Fr%'],
        ['5', '1', '0,05', '5%', '1', '5%'],
        ['6', '5', '0,25', '25%', '6', '30%'],
        ['7', '8', '0,40', '40%', '14', '70%'],
        ['8', '4', '0,20', '20%', '18', '90%'],
        ['9', '2', '0,10', '10%', '20', '100%'],
        ['Total', '20', '1,00', '100%', '', '']
      ],
      steps: 'PASSO 1: Valores √∫nicos: 5,6,7,8,9. PASSO 2: Contar frequ√™ncias: nota 5 aparece 1 vez; nota 6 aparece 5 vezes; nota 7 aparece 8 vezes; nota 8 aparece 4 vezes; nota 9 aparece 2 vezes. Total: 20. PASSO 3: Frequ√™ncia relativa: 1/20=0,05; 5/20=0,25; 8/20=0,40; 4/20=0,20; 2/20=0,10. PASSO 4: Percentual: 5%, 25%, 40%, 20%, 10%. PASSO 5: Acumulada: 1, 6, 14, 18, 20. INTERPRETA√á√ÉO: Moda √© 7 com 40%. 70% tiraram at√© 7.',
      audio: 'Construindo tabela de frequ√™ncia simples. Identificamos valores: 5, 6, 7, 8 e 9. Contamos: nota 5 aparece 1 vez. Nota 6 aparece 5 vezes. Nota 7 aparece 8 vezes, a mais frequente. Nota 8 aparece 4 vezes. Nota 9 aparece 2 vezes. Total: 20 alunos. Frequ√™ncia relativa: 1 dividido 20 igual 0,05. 5 dividido 20 igual 0,25. 8 dividido 20 igual 0,40. 4 dividido 20 igual 0,20. 2 dividido 20 igual 0,10. Em percentual: 5%, 25%, 40%, 20% e 10%. Frequ√™ncia acumulada: 1, 6, 14, 18 e 20. A moda √© 7 com 40% dos alunos.',
      color: 'from-cyan-500 to-blue-600'
    },
    freqInterval: {
      title: 'Frequ√™ncia por Intervalos',
      formula: 'h = amplitude / k | k = ‚àön',
      explanation: 'Agrupa dados em classes. N√∫mero de classes pela raiz de n. Amplitude de classe √© amplitude total dividida por k. Usado para muitos valores diferentes.',
      exampleTitle: 'Exemplo: Alturas de 30 Pessoas',
      exampleData: 'Alturas: 150 a 192 cm (30 pessoas)',
      tableData: [
        ['Classe', 'Intervalo', 'xi', 'fi', 'fr%', 'Fi'],
        ['1', '150‚ä¢158', '154', '4', '13,3%', '4'],
        ['2', '158‚ä¢166', '162', '6', '20,0%', '10'],
        ['3', '166‚ä¢174', '170', '8', '26,7%', '18'],
        ['4', '174‚ä¢182', '178', '7', '23,3%', '25'],
        ['5', '182‚ä¢190', '186', '4', '13,3%', '29'],
        ['6', '190‚ä¢198', '194', '1', '3,3%', '30'],
        ['Total', '', '', '30', '100%', '']
      ],
      steps: 'PASSO 1: N√∫mero de classes: k=‚àö30‚âà6. PASSO 2: Amplitude total: 192-150=42cm. PASSO 3: Amplitude de classe: 42/6=7, usamos 8. PASSO 4: Intervalos: 150-158, 158-166, 166-174, 174-182, 182-190, 190-198. PASSO 5: Pontos m√©dios: 154, 162, 170, 178, 186, 194. PASSO 6: Contar valores em cada intervalo: 4, 6, 8, 7, 4, 1. INTERPRETA√á√ÉO: Classe modal 166-174cm com 26,7%. Distribui√ß√£o aproximadamente sim√©trica.',
      audio: 'Construindo tabela por intervalos para 30 alturas. Passo 1: N√∫mero de classes, raiz de 30 √© 6. Passo 2: Amplitude, 192 menos 150 igual 42 cent√≠metros. Passo 3: Amplitude de classe, 42 dividido 6 igual 7, usamos 8. Passo 4: Criamos intervalos: 150 at√© 158, 158 at√© 166, 166 at√© 174, 174 at√© 182, 182 at√© 190, 190 at√© 198. Passo 5: Pontos m√©dios: 154, 162, 170, 178, 186, 194. Passo 6: Contamos valores: primeira classe 4 pessoas, segunda 6, terceira 8 que √© a maior, quarta 7, quinta 4, sexta 1. Classe modal √© 166 a 174 cent√≠metros com 26,7% das pessoas.',
      color: 'from-teal-500 to-green-600'
    },
    mean: {
      title: 'M√©dia Aritm√©tica',
      formula: 'Œº = Œ£x·µ¢ / N',
      explanation: 'Medida de tend√™ncia central mais comum. Soma todos os valores e divide pelo total. Sens√≠vel a valores extremos (outliers).',
      exampleTitle: 'Exemplo: Sal√°rios de 6 Funcion√°rios',
      exampleData: 'Sal√°rios: 3000, 3200, 3100, 3500, 3000, 15000',
      tableData: [
        ['Func.', 'Sal√°rio'],
        ['1', 'R$ 3.000'],
        ['2', 'R$ 3.200'],
        ['3', 'R$ 3.100'],
        ['4', 'R$ 3.500'],
        ['5', 'R$ 3.000'],
        ['6', 'R$ 15.000'],
        ['Soma', 'R$ 30.800']
      ],
      steps: 'PASSO 1: Somar: 3000+3200+3100+3500+3000+15000=30800. PASSO 2: Dividir: 30800/6=5133,33. RESULTADO: M√©dia R$ 5.133,33. AN√ÅLISE CR√çTICA: 5 funcion√°rios ganham 3000-3500. 1 ganha 15000 (outlier). Sem outlier: m√©dia seria 3160. Com outlier: 5133, diferen√ßa de 62%! Mediana seria mais representativa: R$ 3.150.',
      audio: 'Calculando m√©dia de sal√°rios. Somamos: 3000 mais 3200 d√° 6200. Mais 3100 d√° 9300. Mais 3500 d√° 12800. Mais 3000 d√° 15800. Mais 15000 d√° 30800 reais. Dividimos por 6 funcion√°rios: 30800 dividido 6 igual 5133 reais. Mas aten√ß√£o! 5 funcion√°rios ganham entre 3000 e 3500. Apenas 1 ganha 15000, um outlier que distorce a m√©dia. Sem ele, a m√©dia seria 3160 reais, muito diferente! A m√©dia aumentou 62% por causa de um √∫nico valor. Neste caso, a mediana de 3150 reais √© mais representativa.',
      color: 'from-orange-500 to-red-600'
    },
    median: {
      title: 'Mediana',
      formula: 'Md = valor central',
      explanation: 'Valor que divide os dados ao meio. 50% abaixo, 50% acima. Se √≠mpar, √© o valor central. Se par, m√©dia dos dois centrais. Menos sens√≠vel a outliers.',
      exampleTitle: 'Exemplo: Tempo de Espera',
      exampleData: 'Tempos: 5, 12, 8, 45, 10, 9, 7 minutos',
      tableData: [
        ['Original', 'Ordenado'],
        ['5', '5'],
        ['12', '7'],
        ['8', '8'],
        ['45', '9 ‚Üê MEDIANA'],
        ['10', '10'],
        ['9', '12'],
        ['7', '45']
      ],
      steps: 'PASSO 1: Ordenar: 5,7,8,9,10,12,45. PASSO 2: n=7 (√≠mpar), mediana √© posi√ß√£o (7+1)/2=4. PASSO 3: Mediana = 9 minutos. COMPARA√á√ÉO: M√©dia=(5+7+8+9+10+12+45)/7=13,7 min. INTERPRETA√á√ÉO: Mediana 9 min √© mais representativa que m√©dia 13,7 min, pois 45 √© outlier.',
      audio: 'Calculando mediana de tempos de espera: 5, 12, 8, 45, 10, 9 e 7 minutos. Primeiro, ordenamos: 5, 7, 8, 9, 10, 12, 45. Temos 7 valores, n√∫mero √≠mpar. A mediana √© o valor do meio, posi√ß√£o 4: 9 minutos. Comparando com a m√©dia: somando tudo d√° 96, dividido por 7 d√° 13,7 minutos. Veja a diferen√ßa! O valor 45 √© um outlier que distorce a m√©dia. A mediana de 9 minutos representa melhor o tempo t√≠pico de espera.',
      color: 'from-indigo-500 to-blue-600'
    },
    mode: {
      title: 'Moda',
      formula: 'Mo = valor mais frequente',
      explanation: 'Valor que aparece mais vezes. Pode ter uma moda (unimodal), duas (bimodal) ou mais. √önica medida para dados categ√≥ricos.',
      exampleTitle: 'Exemplo: Tamanhos de Camiseta',
      exampleData: 'Vendas: P,M,M,G,M,P,G,M,GG,M,G,M',
      tableData: [
        ['Tamanho', 'Frequ√™ncia'],
        ['P', '2'],
        ['M', '6 ‚Üê MODA'],
        ['G', '3'],
        ['GG', '1'],
        ['Total', '12']
      ],
      steps: 'PASSO 1: Contar frequ√™ncias: P=2, M=6, G=3, GG=1. PASSO 2: Identificar maior: M com 6 vendas (50%). RESULTADO: Moda = M. INTERPRETA√á√ÉO: Tamanho M √© o mais vendido. Distribui√ß√£o unimodal. Estoque deve priorizar tamanho M.',
      audio: 'Identificando moda de vendas de camisetas: P, M, M, G, M, P, G, M, GG, M, G, M. Contamos: P aparece 2 vezes. M aparece 6 vezes. G aparece 3 vezes. GG aparece 1 vez. Total de 12 vendas. A moda √© M com 6 vendas, metade do total! Esta informa√ß√£o √© √∫til: o gerente deve manter mais estoque do tamanho M, o mais procurado. √â uma distribui√ß√£o unimodal com apenas um valor mais frequente.',
      color: 'from-yellow-500 to-orange-600'
    },
    correlation: {
      title: 'Correla√ß√£o',
      formula: 'r = Cov(X,Y) / (œÉx √ó œÉy)',
      explanation: 'Mede rela√ß√£o linear entre vari√°veis. Varia de -1 a +1. Positivo: ambas crescem. Negativo: uma cresce, outra decresce. Zero: sem rela√ß√£o.',
      exampleTitle: 'Exemplo: Altura vs Peso',
      exampleData: 'Altura: 160,165,170,175,180 | Peso: 55,60,68,75,80',
      tableData: [
        ['Pessoa', 'Alt(cm)', 'Peso(kg)'],
        ['1', '160', '55'],
        ['2', '165', '60'],
        ['3', '170', '68'],
        ['4', '175', '75'],
        ['5', '180', '80'],
        ['M√©dia', '170', '67,6']
      ],
      steps: 'PASSO 1: M√©dias: altura=170cm, peso=67,6kg. PASSO 2: Desvios padr√£o: œÉx=7,07, œÉy=9,58. PASSO 3: Covari√¢ncia: Cov=67,5. PASSO 4: Correla√ß√£o: r=67,5/(7,07√ó9,58)=67,5/67,75=0,996. RESULTADO: r=0,996 (correla√ß√£o positiva muito forte). INTERPRETA√á√ÉO: Rela√ß√£o linear quase perfeita. Maior altura associada a maior peso.',
      audio: 'Calculando correla√ß√£o entre altura e peso de 5 pessoas. Alturas: 160, 165, 170, 175 e 180 cent√≠metros. Pesos: 55, 60, 68, 75 e 80 quilos. M√©dias: altura 170, peso 67,6. Desvios padr√£o: 7,07 para altura, 9,58 para peso. Covari√¢ncia: 67,5. Correla√ß√£o: 67,5 dividido por 7,07 vezes 9,58. Isso d√° 67,5 dividido por 67,75, igual a 0,996. Esse valor indica correla√ß√£o positiva quase perfeita! Quanto maior a altura, maior o peso. Vari√°veis altamente relacionadas.',
      color: 'from-red-500 to-pink-600'
    }
  };

  const speak = (text) => {
    if (speaking) {
      window.speechSynthesis.cancel();
      setSpeaking(false);
      return;
    }

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'pt-BR';
    utterance.rate = 0.85;
    utterance.pitch = 1;
    utterance.volume = 1;
    
    if (selectedVoice) {
      utterance.voice = selectedVoice;
    }

    utterance.onstart = () => setSpeaking(true);
    utterance.onend = () => setSpeaking(false);
    utterance.onerror = () => setSpeaking(false);

    window.speechSynthesis.speak(utterance);
  };

  const currentTopic = topics[selectedTopic];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 md:p-6">
      <div className="max-w-6xl mx-auto">
        <div className="text-center mb-6">
          <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">
            üìä Estat√≠stica Descritiva com √Åudio
          </h1>
          <p className="text-purple-200 text-sm md:text-base">
            Aprenda com c√°lculos detalhados, tabelas e exemplos pr√°ticos
          </p>
        </div>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-6">
          {Object.entries(topics).map(([key, topic]) => (
            <button
              key={key}
              onClick={() => {
                setSelectedTopic(key);
                setShowExample(false);
              }}
              className={`p-2 md:p-3 rounded-lg font-semibold text-xs md:text-sm transition-all transform hover:scale-105 ${
                selectedTopic === key
                  ? `bg-gradient-to-r ${topic.color} text-white shadow-lg`
                  : 'bg-white/10 text-white hover:bg-white/20'
              }`}
            >
              {topic.title}
            </button>
          ))}
        </div>

        <div className={`bg-gradient-to-r ${currentTopic.color} p-1 rounded-2xl shadow-2xl mb-6`}>
          <div className="bg-slate-900 rounded-xl p-4 md:p-6">
            <h2 className="text-xl md:text-2xl font-bold text-white mb-3">
              {currentTopic.title}
            </h2>
            
            <div className="bg-white/10 rounded-lg p-3 md:p-4 mb-4">
              <p className="text-center text-lg md:text-2xl font-mono text-white">
                {currentTopic.formula}
              </p>
            </div>

            <div className="flex gap-2 mb-4">
              <button
                onClick={() => setShowExample(false)}
                className={`flex-1 py-2 px-3 text-sm rounded-lg font-semibold transition-all ${
                  !showExample ? 'bg-white text-purple-900' : 'bg-white/20 text-white'
                }`}
              >
                Teoria
              </button>
              <button
                onClick={() => setShowExample(true)}
                className={`flex-1 py-2 px-3 text-sm rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${
                  showExample ? 'bg-white text-purple-900' : 'bg-white/20 text-white'
                }`}
              >
                <Calculator size={16} />
                C√°lculos
              </button>
            </div>

            {!showExample ? (
              <div className="bg-white/5 rounded-lg p-4 mb-4">
                <p className="text-white text-sm md:text-base leading-relaxed">
                  {currentTopic.explanation}
                </p>
              </div>
            ) : (
              <div className="bg-white/5 rounded-lg p-4 mb-4 space-y-4">
                <h3 className="text-lg font-bold text-white">{currentTopic.exampleTitle}</h3>
                <p className="text-purple-200 text-sm font-mono">{currentTopic.exampleData}</p>
                
                {currentTopic.tableData && (
                  <div className="overflow-x-auto">
                    <table className="w-full text-white text-xs md:text-sm border-collapse">
                      <tbody>
                        {currentTopic.tableData.map((row, i) => (
                          <tr key={i} className={i === 0 ? 'bg-white/20 font-bold' : 'bg-white/5'}>
                            {row.map((cell, j) => (
                              <td key={j} className="border border-white/20 p-2 text-center">
                                {cell}
                              </td>
                            ))}
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
                
                <div className="bg-white/10 rounded p-3">
                  <pre className="text-white text-xs md:text-sm whitespace-pre-wrap font-mono">
                    {currentTopic.steps}
                  </pre>
                </div>
              </div>
            )}

            <div className="flex gap-3 mb-4">
              <button
                onClick={() => speak(showExample ? currentTopic.audio : currentTopic.explanation)}
                className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-lg font-bold transition-all ${
                  speaking ? 'bg-red-500 text-white' : 'bg-white text-purple-900'
                }`}
              >
                {speaking ? (
                  <>
                    <Square size={20} fill="currentColor" />
                    Parar
                  </>
                ) : (
                  <>
                    <Play size={20} fill="currentColor" />
                    Ouvir {showExample ? 'C√°lculos' : 'Teoria'}
                  </>
                )}
              </button>
            </div>

            {voices.length > 0 && (
              <div>
                <label className="block text-white text-xs mb-2">
                  üéôÔ∏è Voz ({voices.length} dispon√≠veis):
                </label>
                <select
                  value={selectedVoice?.name || ''}
                  onChange={(e) => {
                    const voice = voices.find(v => v.name === e.target.value);
                    setSelectedVoice(voice);
                  }}
                  className="w-full bg-white/10 text-white text-xs rounded-lg p-2 border border-white/20"
                >
                  {voices.map((voice) => (
                    <option key={voice.name} value={voice.name} className="bg-slate-900">
                      {voice.name}
                    </option>
                  ))}
                </select>
              </div>
            )}
          </div>
        </div>

        <div className="bg-white/10 rounded-lg p-4 text-white">
          <h3 className="font-bold mb-2 flex items-center gap-2 text-sm">
            <Volume2 size={18} />
            Como usar:
          </h3>
          <ul className="space-y-1 text-xs text-purple-200">
            <li>‚Ä¢ Escolha um conceito nos bot√µes acima</li>
            <li>‚Ä¢ Veja a Teoria ou os C√°lculos detalhados</li>
            <li>‚Ä¢ Use Ouvir para narra√ß√£o em portugu√™s</li>
            <li>‚Ä¢ Troque a voz no seletor abaixo</li>
          </ul>
        </div>
      </div>
    </div>
  );
}
